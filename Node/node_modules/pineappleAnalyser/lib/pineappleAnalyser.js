var ofcp = require('ofcp');
var pe = require('poker-evaluator');

//offical pineapple/ofcp royalties
var rules = {front:true, mid:[2,4,8,12,20,30,50], back:[2,4,6,10,15,25]};

var pineappleAnalyser = module.exports = {
    /**
	 * 
     * @param Array of Hands (hands are assoc. arrays)
     * @returns hands with original string values changed to numerical card values
     */
    _handStringToValues: function(hands){
        for(var i=0; i<hands.length; i++){
            hands[i].front = ofcp.hand(hands[i].front);
              hands[i].mid = ofcp.hand(hands[i].mid);
             hands[i].back = ofcp.hand(hands[i].back);
        }
        return hands;
   },

   /**
    * Returns array of points for each player in the hand
    * 
    * params: hands - Array of hands in the format of:
    * var hand1 = {
    *      back: ofcp.hand('7s 7s 7s 3s 3s'),
    *       mid: ofcp.hand('Ts Ts Ts Ts 3s'),
    *     front: ofcp.hand('As As As')
    * }, etc etc
    */
    settlement: function(hands){
       hands = module.exports._handStringToValues(hands); //change to numerical values
       if(hands.length === 2){
		    let score = ofcp.settle(hands[0], hands[1], rules);
		    return [score, -1*score];
       }else{
            let score12 = ofcp.settle(hands[0], hands[1], rules),
                score13 = ofcp.settle(hands[0], hands[2], rules),
                score23 = ofcp.settle(hands[1], hands[2], rules),
                player1 = score12 + score13,
                player2 = (-1 * score12) + score23,
                player3 = (-1 * score13) + (-1 * score23);
            return [player1, player2, player3];
       }
   },

   /**
    * FANTASY LAND CONDITIONS:
    * Front row must be minimum pair of Jacks.
    * Test this by using ofcp.evalFrontHand(hand);
    *                                       //Jh, Jd, 2s
    * In poker-evaluator: ofcp.evalFrontHand([39, 38, 4])  
    *                     - returns {handtype:2,handName:'one pair',handRank}
    * 
    * Thus, the condition for the player to be in fantasy land is:
    *              - handType == 2 (pair) || handType==4 (three of a kind)
    *              - handRank >= 131 (pair of Jacks or better of handType==2)
    * Note: value does increase with the kicker. I.e. JJ2.value < JJA.value
    *       However, due to the rounding nature of the algorithm, some hands may
    *       have the same value. I.e. JJ2.value === JJ3.value
    *       
    * @param hand : Array of card values:  E.g. [37, 44, 8]
    * @returns if hand qualifies for following hand to be fantasy
    */
    _isFantasy: function(hand){
	   var evaluatedHand = ofcp.evalFrontHand(hand);

	   //return true if hand is trips or a pair of JJ or better
	   return (evaluatedHand.handType === 4 || 
			   (evaluatedHand.handType === 2 && evaluatedHand.handRank >= 131));
   }
};